!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.streamamg=t():(e.playkit=e.playkit||{},e.playkit.providers=e.playkit.providers||{},e.playkit.providers.streamamg=t())}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=33)}([function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(3);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=function e(t,r,n,a){void 0===a&&(a={}),this.severity=t,this.category=r,this.code=n,this.data=a,e._logger.error("Category:"+r+" | Code:"+n+" |",a)};a(i,"Severity",{RECOVERABLE:1,CRITICAL:2}),a(i,"Category",{NETWORK:1,SERVICE:2,PROVIDER:3}),a(i,"Code",{UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,BAD_SERVER_RESPONSE:1005,MULTIREQUEST_API_ERROR:1006,API_RESPONSE_MISMATCH:1007,ERROR:2e3,BLOCK_ACTION:2001,MEDIA_STATUS_NOT_READY:2002,MISSING_MANDATORY_PARAMS:3e3,MISSING_PLAY_SOURCE:3001,METHOD_NOT_IMPLEMENTED:3002}),a(i,"_logger",Object(n.b)("Error"))},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(15);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=function(){function e(){this.metadata=new Map,this.sources=new n.a,this.type=e.Type.UNKNOWN}return e.prototype.toJSON=function(){return{id:this.id,name:this.name,sources:this.sources.toJSON(),duration:this.duration,dvrStatus:this.dvrStatus,status:this.status,metadata:this.metadata,type:this.type,poster:this.poster,assetReferenceType:this.assetReferenceType}},e}();a(i,"Type",{VOD:"Vod",LIVE:"Live",IMAGE:"Image",AUDIO:"Audio",UNKNOWN:"Unknown"}),a(i,"DvrStatus",{ON:1,OFF:0})},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(0);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=function(){function e(e){void 0===e&&(e=new Map),a(this,"retryConfig",{async:!0,timeout:0,maxAttempts:4}),a(this,"_attemptCounter",1),this.headers=e}var t=e.prototype;return t.getUrl=function(e){return e+"/service/"+this.service+(this.action?"/action/"+this.action:"")},t.doHttpRequest=function(){var e=this,t=new Promise((function(t,r){e._requestPromise={resolve:t,reject:r}}));return this.url||this._requestPromise.reject(new n.a(n.a.Severity.CRITICAL,n.a.Category.NETWORK,n.a.Code.MALFORMED_DATA_URI,{url:this.url})),this._createXHR(),t},t._createXHR=function(){var e=this,t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState&&200===t.status)try{var r=JSON.parse(t.responseText);return e.responseHeaders=e._getResponseHeaders(t),e._requestPromise.resolve(r)}catch(r){e._requestPromise.reject(e._createError(t,n.a.Code.BAD_SERVER_RESPONSE,{text:t.responseText}))}},t.open(this.method,this.url,this.retryConfig.async),this.retryConfig.async&&this.retryConfig.timeout&&(t.timeout=this.retryConfig.timeout);var r=performance.now();t.ontimeout=function(){e._handleError(t,n.a.Code.TIMEOUT,{timeout:(performance.now()-r)/1e3,statusText:t.statusText})},t.onerror=t.onabort=function(){e._handleError(t,n.a.Code.HTTP_ERROR,{text:t.responseText,statusText:t.statusText})},this.headers.forEach((function(e,r){t.setRequestHeader(r,e)})),t.send(this.params)},t._getResponseHeaders=function(e){return e.getAllResponseHeaders().split("\n").filter((function(e){return 0===e.toLowerCase().indexOf("x-")}))},t._handleError=function(e,t,r){var n=this._createError(e,t,r);if(e.onreadystatechange=function(){},e.onerror=function(){},e.ontimeout=function(){},e.onabort=function(){},!(this.retryConfig.maxAttempts&&this._attemptCounter<this.retryConfig.maxAttempts))return this._requestPromise.reject(n);this._attemptCounter++,this._createXHR()},t._createError=function(e,t,r){return Object.assign(r,{url:this.url,headers:this._getResponseHeaders(e),attempt:this._attemptCounter}),new n.a(n.a.Severity.CRITICAL,n.a.Category.NETWORK,t,r)},e}()},function(e,t,r){"use strict";r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return i})),r.d(t,"a",(function(){return a}));var n={get:function(){return{VERSION:"",DEBUG:{value:"",name:""},ERROR:{value:"",name:""},INFO:{value:"",name:""},OFF:{value:"",name:""},TIME:{value:"",name:""},TRACE:{value:"",name:""},WARN:{value:"",name:""},createDefaultHandler:function(){},debug:function(){},enabledFor:function(){},error:function(){},get:function(){},getLevel:function(){},info:function(){},log:function(){},setHandler:function(){},setLevel:function(){},time:function(){},timeEnd:function(){},trace:function(){},useDefaults:function(){},warn:function(){}}}},a={};function i(e){e&&"function"==typeof e.getLogger&&(n.get=e.getLogger),e&&e.LogLevel&&(a=e.LogLevel)}function s(e){return n.get(e)}function o(e){return s(e).getLevel()}function u(e,t){s(t).setLevel(e)}t.b=s},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(21),a={serviceUrl:"https://cdnapisec.kaltura.com/api_v3",cdnUrl:"https://cdnapisec.kaltura.com",serviceParams:{apiVersion:"3.3.0",format:1},useApiCaptions:!0},i=function(){function e(){}return e.set=function(e){e&&Object.assign(a,e)},e.get=function(){return Object(n.a)(a)},e}()},function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,"a",(function(){return a}));var a=function(e){this.id=e.id,this.referenceId=e.referenceId,this.externalSourceType=e.externalSourceType,this.name=e.name,this.description=e.description,this.dataUrl=e.dataUrl,this.type=e.type,this.entryType=e.mediaType,this.flavorParamsIds=e.flavorParamsIds,this.duration=e.duration,this.poster=e.thumbnailUrl,this.status=e.status,this.dvrStatus=e.dvrStatus,this.tags=e.tags};n(a,"EntryType",{AUTOMATIC:{value:-1},EXTERNAL_MEDIA:{value:"externalMedia.externalMedia"},MEDIA_CLIP:{value:1},MIX:{value:2},PLAYLIST:{value:5},DATA:{value:6},LIVE_STREAM:{value:7},LIVE_CHANNEL:{value:8},DOCUMENT:{value:10}}),n(a,"MediaType",{VIDEO:{value:1},IMAGE:{value:2},AUDIO:{value:5},LIVE_STREAM_FLASH:{value:201},LIVE_STREAM_WINDOWS_MEDIA:{value:202},LIVE_STREAM_REAL_MEDIA:{value:203},LIVE_STREAM_QUICK_TIME:{value:204}}),n(a,"EntryStatus",{ERROR_IMPORTING:-2,ERROR_CONVERTING:-1,SCAN_FAILURE:"virusScan.ScanFailure",IMPORT:0,INFECTED:"virusScan.Infected",PRECONVERT:1,READY:2,DELETED:3,PENDING:4,MODERATE:5,BLOCKED:6,NO_CONTENT:7}),n(a,"EntryModerationStatus",{PENDING_MODERATION:1,APPROVED:2,REJECTED:3,FLAGGED_FOR_REVIEW:4,MODERATE:5,AUTO_APPROVED:6})},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return i}));var n={DASH:{name:"dash",mimeType:"application/dash+xml",pathExt:"mpd"},HLS:{name:"hls",mimeType:"application/x-mpegURL",pathExt:"m3u8"},WVM:{name:"wvm",mimeType:"video/wvm",pathExt:"wvm"},MP4:{name:"mp4",mimeType:"video/mp4",pathExt:"mp4"},MP3:{name:"mp3",mimeType:"audio/mpeg",pathExt:"mp3"}},a=new Map([["mpegdash",n.DASH],["applehttp",n.HLS],["url",n.MP4]]);function i(e){var t=a.get(e);return!!t&&t.name===n.MP4.name}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n=function(e){var t,r,n;n=!1,(r="hasError")in(t=this)?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,"KalturaAPIException"===e.objectType?(this.hasError=!0,this.error=new a(e.code,e.message)):e.error&&"KalturaAPIException"===e.error.objectType?(this.hasError=!0,this.error=new a(e.error.code,e.error.message)):this.data=e},a=function(e,t){this.code=e,this.message=t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(13),a=r(4),i=function(){function e(){}return e.getMultiRequest=function(e,t,r){var i=a.a.get(),s=i.serviceParams;Object.assign(s,{ks:t,clientTag:"html5:v"+e}),r&&Object.assign(s,{partnerId:r});var o=new Map;o.set("Content-Type","application/json");var u=new n.b(o);return u.method="POST",u.service="multirequest",u.url=u.getUrl(i.serviceUrl),u.params=s,u},e}()},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n,a,i,s=function(e){this.type=e.type};i={DRM_POLICY:"drm.DRM_POLICY",BLOCK:1,PREVIEW:2,LIMIT_FLAVORS:3,ADD_TO_STORAGE:4,LIMIT_DELIVERY_PROFILES:5,SERVE_FROM_REMOTE_SERVER:6,REQUEST_HOST_REGEX:7,LIMIT_THUMBNAIL_CAPTURE:8},(a="Type")in(n=s)?Object.defineProperty(n,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[a]=i},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r(18);var n=function(){function e(){}return e.prototype.toJSON=function(){var e={id:this.id,url:this.url,mimetype:this.mimetype};return this.bandwidth&&(e.bandwidth=this.bandwidth),this.width&&(e.width=this.width),this.height&&(e.height=this.height),this.label&&(e.label=this.label),this.drmData&&this.drmData.length>0&&(e.drmData=[],this.drmData.forEach((function(t){Array.isArray(e.drmData)&&e.drmData.push(t.toJSON())}))),e},e}()},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(8),a=r(2),i=r(24);var s=function(e){var t,r;function n(){return e.apply(this,arguments)||this}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n.getPlaybackContext=function(e,t,r){var n=new Map;n.set("Content-Type","application/json");var i=new a.a(n);i.service="baseEntry",i.action="getPlaybackContext",i.method="POST",i.url=i.getUrl(e),i.tag="baseEntry-getPlaybackContext";return i.params={entryId:r,ks:t,contextDataParams:{objectType:"KalturaContextDataParams",flavorTags:"all"}},i},n.list=function(e,t,r,i,s){var o=new Map;o.set("Content-Type","application/json");var u=new a.a(o);return u.service="baseEntry",u.action="list",u.method="POST",u.url=u.getUrl(e),u.tag="list",u.params=n.getEntryListReqParams(r,t,i,s),u},n.getEntryListReqParams=function(e,t,r,n){var a={};return e?a=r?{redirectFromEntryId:e}:{idEqual:e}:n&&(a={objectType:"KalturaBaseEntryFilter",referenceIdEqual:n}),{ks:t,filter:a,responseProfile:new i.a}},n}(n.a)},function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var n=r(8),a=r(2);var i=function(e){var t,r;function n(){return e.apply(this,arguments)||this}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n.anonymousSession=function(e,t){var r=new Map;r.set("Content-Type","application/json");var n=new a.a(r);return n.service="session",n.action="startWidgetSession",n.method="POST",n.url=n.getUrl(e),n.tag="session-startWidget",n.params={widgetId:t},n},n}(n.a),s=r(4);function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=function(){var e,t,r;function n(e){var t,r,n;n={},(r="_response")in(t=this)?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,this.requests=this.buildRequests(e),this._widgetId=e.widgetId}e=n,r=[{key:"id",get:function(){return"session"}}],(t=[{key:"requests",set:function(e){this._requests=e},get:function(){return this._requests}},{key:"response",set:function(e){this._response.ks=e[0].data.ks},get:function(){return this._response.ks}}])&&o(e.prototype,t),r&&o(e,r);var a=n.prototype;return a.buildRequests=function(e){var t=s.a.get(),r=[];return r.push(i.anonymousSession(t.serviceUrl,e.widgetId)),r},a.isValid=function(){return!!this._widgetId},n}()},function(e,t,r){"use strict";r.d(t,"b",(function(){return c})),r.d(t,"a",(function(){return l}));var n=r(2),a=r(3),i=r(7),s=r(0);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var c=function(e){var t,r;function n(){for(var t,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return u(o(t=e.call.apply(e,[this].concat(n))||this),"requests",[]),t}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var a=n.prototype;return a.add=function(e){var t;this.requests.push(e);var r={},n={service:e.service,action:e.action};return Object.assign(r,((t={})[this.requests.length]=Object.assign(n,e.params),t)),Object.assign(r,this.params),this.params=r,this},a.execute=function(){var e=this;return new Promise((function(t,r){try{e.params=JSON.stringify(e.params)}catch(t){n._logger.error(""+t.message),r(new s.a(s.a.Severity.CRITICAL,s.a.Category.PROVIDER,s.a.Code.FAILED_PARSING_REQUEST,{error:t,params:e.params}))}e.doHttpRequest().then((function(n){var a=new l(n);a.success?t({headers:e.responseHeaders,response:a}):r(new s.a(s.a.Severity.CRITICAL,s.a.Category.NETWORK,s.a.Code.MULTIREQUEST_API_ERROR,{url:e.url,headers:e.responseHeaders,results:a.results}))}),(function(e){r(e)}))}))},n}(n.a);u(c,"_logger",Object(a.b)("MultiRequestBuilder"));var l=function e(t){var r=this;u(this,"results",[]),this.success=!0,(t.result?t.result:t).forEach((function(t){var n=new i.a(t);if(r.results.push(n),n.hasError)return e._logger.error("Service returned an error with error code: "+n.error.code+" and message: "+n.error.message+"."),void(r.success=!1)}))};u(l,"_logger",Object(a.b)("MultiRequestResult"))},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n,a,i,s=function(e){this.scheme=e.scheme,this.licenseURL=e.licenseURL,this.certificate=e.certificate};i={"drm.PLAYREADY_CENC":"com.microsoft.playready","drm.WIDEVINE_CENC":"com.widevine.alpha","fairplay.FAIRPLAY":"com.apple.fairplay",WIDEVINE_CENC:"com.widevine.alpha",PLAYREADY_CENC:"com.microsoft.playready",FAIRPLAY:"com.apple.fairplay"},(a="Scheme")in(n=s)?Object.defineProperty(n,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[a]=i},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r(10);var n=r(6),a=function(){function e(){this.progressive=[],this.dash=[],this.hls=[]}var t=e.prototype;return t.map=function(e,t){if(t)switch(t.name){case n.a.MP4.name:this.progressive.push(e);break;case n.a.DASH.name:this.dash.push(e);break;case n.a.HLS.name:this.hls.push(e)}},t.toJSON=function(){var e={progressive:[],dash:[],hls:[]};return this.progressive.forEach((function(t){return e.progressive.push(t.toJSON())})),this.hls.forEach((function(t){return e.hls.push(t.toJSON())})),this.dash.forEach((function(t){return e.dash.push(t.toJSON())})),e},e}()},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));r(13);var n=r(0);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=function(){function e(e){a(this,"_loadersResponseMap",new Map),a(this,"_loaders",new Map),this._networkRetryConfig=e}var t=e.prototype;return t.add=function(e,t){var r=this,n=new e(t);if(n.isValid()){this._loaders.set(e.id,n);var a=this._multiRequest.requests.length,i=n.requests;this._multiRequest.retryConfig=this._networkRetryConfig,i.forEach((function(e){r._multiRequest.add(e)}));var s=Array.from(new Array(i.length),(function(e,t){return t+a}));this._loadersResponseMap.set(e.id,s)}},t.fetchData=function(){var e=this;return new Promise((function(t,r){e._multiRequest.execute().then((function(a){e._multiResponse=a.response,e.prepareData(a.response).success?t(e._loaders):r(new n.a(n.a.Severity.CRITICAL,n.a.Category.NETWORK,n.a.Code.API_RESPONSE_MISMATCH,{headers:a.headers}))}),(function(e){r(e)}))}))},t.prepareData=function(e){var t=this;return this._loaders.forEach((function(r,n){var a=t._loadersResponseMap.get(n);try{a&&a.length>0&&(r.response=e.results.slice(a[0],a[a.length-1]+1))}catch(e){return{success:!1,error:e}}})),{success:!0,data:this._loaders}},e}()},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n=function(e){this.message=e.message,this.code=e.code}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n=function(){function e(e,t,r){this.licenseUrl=e,this.scheme=t,r&&(this.certificate=r)}return e.prototype.toJSON=function(){var e={licenseUrl:this.licenseUrl,scheme:this.scheme};return this.certificate&&(e.certificate=this.certificate),e},e}()},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(14);var a=function(){function e(e){var t,r,a,i=this;a=[],(r="drm")in(t=this)?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,this.format=e.format,this.deliveryProfileId=e.deliveryProfileId,this.url=e.url,this.protocols=e.protocols,this.flavorIds=e.flavorIds,e.drm&&e.drm.map((function(e){return i.drm.push(new n.a(e))}))}var t=e.prototype;return t.hasDrmData=function(){return this.drm&&this.drm.length>0},t.hasFlavorIds=function(){return!!this.flavorIds&&this.flavorIds.length>0},t.getProtocol=function(e){var t="";if(this.protocols&&this.protocols.length>0)this.protocols.split(",").forEach((function(r){r===e&&(t=r)}));else if("http"===e)return e;return t},e}()},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(7),a=r(5);var i=function(e){var t,r;function n(t){var r;return(r=e.call(this,t)||this).hasError||(r.totalCount=t.totalCount,r.totalCount>0&&(r.entries=[],t.objects.map((function(e){return r.entries.push(new a.a(e))})))),r}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n}(n.a)},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n=function e(t){var r;return Array.isArray(t)?(r=t.length>0?t.slice(0):[]).forEach((function(t,n){("object"==typeof t&&t!=={}||Array.isArray(t)&&t.length>0)&&(r[n]=e(t))})):"object"==typeof t?(r=Object.assign({},t),Object.keys(r).forEach((function(t){("object"==typeof r[t]&&r[t]!=={}||Array.isArray(r[t])&&r[t].length>0)&&(r[t]=e(r[t]))}))):r=t,r}},function(e,t,r){"use strict";r.d(t,"a",(function(){return y}));var n=r(7),a=r(17),i=r(19),s=r(9);var o=function(e){var t,r;function n(t){var r;return(r=e.call(this,t)||this).pattern=t.pattern,r.replacement=t.replacement,r.replacmenServerNodeId=t.replacmenServerNodeId,r}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n}(s.a);var u,c,l,d=function(e){this.id=e.id,this.flavorParamsId=e.flavorParamsId,this.fileExt=e.fileExt,this.bitrate=e.bitrate,this.width=e.width,this.height=e.height,this.id=e.id,this.frameRate=e.frameRate,this.isOriginal=e.isOriginal,this.isWeb=e.isWeb,this.containerFormat=e.containerFormat,this.videoCodecId=e.videoCodecId,this.status=e.status,this.language=e.language,this.label=e.label};l={ERROR:-1,QUEUED:0,CONVERTING:1,READY:2,DELETED:3,NOT_APPLICABLE:4,TEMP:5,WAIT_FOR_CONVERT:6,IMPORTING:7,VALIDATING:8,EXPORTING:9},(c="Status")in(u=d)?Object.defineProperty(u,c,{value:l,enumerable:!0,configurable:!0,writable:!0}):u[c]=l;var p=r(28);function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var y=function(e){var t,r;function n(t){var r;if(h(f(r=e.call(this,t)||this),"sources",[]),h(f(r),"actions",[]),h(f(r),"messages",[]),h(f(r),"flavorAssets",[]),h(f(r),"bumperData",[]),!r.hasError){var n=t.messages;n&&n.map((function(e){return r.messages.push(new a.a(e))}));var u=t.actions;u&&u.map((function(e){e.type===s.a.Type.REQUEST_HOST_REGEX?r.actions.push(new o(e)):r.actions.push(new s.a(e))}));var c=t.sources;c&&c.map((function(e){return r.sources.push(new i.a(e))}));var l=t.flavorAssets;l&&l.map((function(e){return r.flavorAssets.push(new d(e))}));var y=t.bumperData;y&&y.map((function(e){return r.bumperData.push(new p.a(e))}))}return r}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var u=n.prototype;return u.hasBlockAction=function(){return void 0!==this.getBlockAction()},u.getBlockAction=function(){return this.actions.find((function(e){return e.type===s.a.Type.BLOCK}))},u.getErrorMessages=function(){return this.messages},u.getRequestHostRegexAction=function(){var e=this.actions.find((function(e){return e.type===s.a.Type.REQUEST_HOST_REGEX}));if(e instanceof o)return e},n}(n.a)},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(7);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=function(e){this.id=e.id,this.metadataProfileId=e.metadataProfileId,this.metadataProfileVersion=e.metadataProfileVersion,this.metadataProfileId=e.metadataProfileId,this.metadataObjectType=e.metadataObjectType,this.objectId=e.objectId,this.version=e.version,this.created=new Date(0),this.created.setUTCSeconds(e.createdAt),this.updated=new Date(0),this.updated.setUTCSeconds(e.updatedAt),this.status=e.status,this.xml=e.xml};a(i,"ObjectType",{AD_CUE_POINT:"adCuePointMetadata.AdCuePoint",ANNOTATION:"annotationMetadata.Annotation",CODE_CUE_POINT:"codeCuePointMetadata.CodeCuePoint",THUMB_CUE_POINT:"thumbCuePointMetadata.thumbCuePoint",ENTRY:1,CATEGORY:2,USER:3,PARTNER:4,DYNAMIC_OBJECT:5}),a(i,"Status",{VALID:1,INVALID:2,DELETED:3});var s=function(e){var t,r;function n(t){var r;return(r=e.call(this,t)||this).hasError||(r.totalCount=t.totalCount,r.totalCount>0&&(r.metas=[],t.objects.map((function(e){return r.metas.push(new i(e))})))),r}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n}(n.a)},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n,a,i,s=function e(t){void 0===t&&(t={}),this.type=t.type||e.Type.INCLUDE_FIELDS,this.fields=t.fields||"id,referenceId,name,description,thumbnailUrl,dataUrl,duration,msDuration,flavorParamsIds,mediaType,type,tags,dvrStatus,externalSourceType,status"};i={INCLUDE_FIELDS:1,EXCLUDE_FIELDS:2},(a="Type")in(n=s)?Object.defineProperty(n,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[a]=i},function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(3),a=(r(16),r(0));function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}var o=function(){function e(e,t){var r,a,i;i={async:!0,timeout:0,maxAttempts:4},(a="_networkRetryConfig")in(r=this)?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i,Object(n.e)(e.logger),this._partnerId=e.partnerId,this._widgetId=e.widgetId,this._uiConfId=e.uiConfId,this._isAnonymous=!e.ks,this._ks=e.ks||"",this._playerVersion=t}s(e,[{key:"partnerId",get:function(){return this._partnerId}},{key:"widgetId",get:function(){return this._widgetId||this.defaultWidgetId}},{key:"defaultWidgetId",get:function(){return"_"+this._partnerId}},{key:"uiConfId",get:function(){return this._uiConfId}},{key:"ks",get:function(){return this._ks},set:function(e){this._ks=e}},{key:"playerVersion",get:function(){return this._playerVersion}},{key:"isAnonymous",get:function(){return this._isAnonymous}}]);var t=e.prototype;return t.getMediaConfig=function(e){return Promise.reject(new a.a(a.a.Severity.CRITICAL,a.a.Category.PROVIDER,a.a.Code.METHOD_NOT_IMPLEMENTED,{message:"getMediaConfig method must be implement by the derived class"}))},t.getPlaylistConfig=function(e){return Promise.reject(new a.a(a.a.Severity.CRITICAL,a.a.Category.PROVIDER,a.a.Code.METHOD_NOT_IMPLEMENTED,{message:"The provider does not support loading playlist by id"}))},t.getEntryListConfig=function(e){return Promise.reject(new a.a(a.a.Severity.CRITICAL,a.a.Category.PROVIDER,a.a.Code.METHOD_NOT_IMPLEMENTED,{message:"The provider does not support loading entry list"}))},t._verifyHasSources=function(e){if(0===e.hls.concat(e.dash,e.progressive).length)throw new a.a(a.a.Severity.CRITICAL,a.a.Category.SERVICE,a.a.Code.MISSING_PLAY_SOURCE,{action:"",messages:"No play source for entry id: "+e.id})},t.getLogLevel=function(e){return Object(n.c)(e)},t.setLogLevel=function(e,t){Object(n.d)(e,t)},s(e,[{key:"LogLevel",get:function(){return n.a}}]),e}()},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r(1);var n=function(){this.items=[]}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n=function(e){this.url=e.url,this.clickThroughUrl=e.clickThroughUrl}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(19),a=function(e){this.entryId=e.entryId,this.clickThroughUrl=e.url,this.sources=e.sources?e.sources.map((function(e){return new n.a(e)})):[]}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(8),a=r(2);var i=function(e){var t,r;function n(){return e.apply(this,arguments)||this}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n.list=function(e,t,r){var n=new Map;n.set("Content-Type","application/json");var i=new a.a(n);i.service="metadata_metadata",i.action="list",i.method="POST",i.url=i.getUrl(e),i.tag="metadata_metadata-list";var s={objectType:"KalturaMetadataFilter",objectIdEqual:r,metadataObjectTypeEqual:"1"};return i.params={filter:s,ks:t},i},n}(n.a)},function(e,t,r){"use strict";r.d(t,"a",(function(){return $}));var n=r(3),a=r(4),i=r(22),s=r(23),o=r(5),u=(r(19),r(28),r(14)),c=function(){function e(){}return e.build=function(e){var t=a.a.get(),r=t.serviceUrl.substr(0,t.serviceUrl.lastIndexOf("/")),n=e.partnerId,i=e.entryId,s=e.ks,o=e.uiConfId,u=e.format,c=e.protocol,l=e.extension,d=e.flavorIds;if(!(r&&n&&i&&u&&c))return"";var p=r;return r.endsWith("/")||(p+="/"),p+="p/"+n+"/sp/"+n+"00/playManifest/entryId/"+i+"/protocol/"+c+"/format/"+u,d?p+="/flavorIds/"+d:o&&(p+="/uiConfId/"+o),""!==s&&(p+="/ks/"+s),""!==l&&(p+="/a."+l),o&&""!==d&&(p+="?uiConfId="+o),p},e}(),l=function(){function e(){}return e.xmlToJson=function(e){var t={};if(1===e.nodeType){if(e.attributes.length>0){t["@attributes"]={};for(var r=0;r<e.attributes.length;r++){var n=e.attributes.item(r);t["@attributes"][n.nodeName]=n.nodeValue}}}else 3===e.nodeType&&(t=e.nodeValue);if(e.hasChildNodes())for(var a=0;a<e.childNodes.length;a++){var i=e.childNodes.item(a),s=i.nodeName;if(void 0===t[s])t[s]=this.xmlToJson(i);else{if(void 0===t[s].push){var o=t[s];t[s]=[],t[s].push(o)}t[s].push(this.xmlToJson(i))}}return t},e}(),d=r(1),p=r(18),f=r(10),h=r(15),y=r(6),v=function(){this.items=[]},m=r(26),g=r(27),_=(r(9),r(17),{SRT:"1",DFXP:"2",WEBVTT:"3",CAP:"4"}),E={3:"vtt",1:"srt"},I=function(){function e(){}return e.createConfig=function(e,t){return e.map((function(e){var r=e.url,n=E[e.format];return[_.DFXP,_.CAP].includes(e.format)&&(r=e.webVttUrl,n=E[_.WEBVTT]),r=C(r,t),{default:!!e.isDefault,type:n,language:e.languageCode,label:e.label,url:r}}))},e}();var b,R,O,T=function(){function e(){}return e.getMediaEntry=function(t,r,n,i){var s=new d.a,o=i.entry,u=i.playBackContextResult,c=i.metadataListResult,l=u.sources;return s.sources=e._getParsedSources(l,t,r,n,o,u),a.a.get().useApiCaptions&&u.data.playbackCaptions&&(s.sources.captions=I.createConfig(u.data.playbackCaptions,t)),e._fillBaseData(s,o,c),s},e.addKsToUrl=function(e,t){var r;return t?(r=-1!==e.split("?")[0].replace(/^.*[\\/]/,"").indexOf(".")?-1===e.indexOf("?")?"?ks=":"&ks=":"/ks/",e+r+t):e},e.getPlaylist=function(t){var r=new v,n=t.playlistData,a=t.playlistItems.entries;return r.id=n.id,r.name=n.name,r.description=n.description,r.poster=n.poster,a.forEach((function(t){var n=new d.a;e._fillBaseData(n,t),r.items.push(n)})),r},e.getEntryList=function(t){var r=new m.a;return t.playlistItems.entries.forEach((function(t){var n=new d.a;e._fillBaseData(n,t),r.items.push(n)})),r},e.getBumper=function(t,r,n){var a=t.playBackContextResult,i=a.bumperData[0];if(i){var s=(i&&i.sources).find((function(e){return Object(y.c)(e.format)}));if(s){var o=e._parseProgressiveSources(s,a,r,n,0,i.entryId);if(o[0])return new g.a({url:o[0].url,clickThroughUrl:i.clickThroughUrl})}}},e._fillBaseData=function(t,r,n){return t.poster=r.poster,t.id=r.id,t.duration=r.duration,t.metadata=e._parseMetadata(n),t.metadata.description=r.description||"",t.metadata.name=r.name||"",t.metadata.tags=r.tags||"",t.status=r.status,t.type=e._getEntryType(r.entryType,r.type),t.type===d.a.Type.LIVE&&(t.dvrStatus=r.dvrStatus),t},e._getEntryType=function(e,t){var r=d.a.Type.UNKNOWN;switch(e){case o.a.MediaType.IMAGE.value:r=d.a.Type.IMAGE;break;case o.a.MediaType.AUDIO.value:r=d.a.Type.AUDIO;break;default:switch(t){case o.a.EntryType.MEDIA_CLIP.value:r=d.a.Type.VOD;break;case o.a.EntryType.LIVE_STREAM.value:case o.a.EntryType.LIVE_CHANNEL.value:r=d.a.Type.LIVE;break;default:r=d.a.Type.UNKNOWN}}return r},e._getParsedSources=function(t,r,n,a,i,s){var u,c,l=new h.a,d=function(t){var o=e._parseAdaptiveSource(t,s,r,n,a,i.id);if(o){var u=y.b.get(t.format);l.map(o,u)}};return i.type===o.a.EntryType.EXTERNAL_MEDIA.value?((c=new f.a).mimetype="video/youtube",c.url=i.referenceId,c.id=i.id+"_youtube",l.progressive.push(c)):t&&t.length>0&&(t.filter((function(e){return!Object(y.c)(e.format)})).forEach(d),u=t.find((function(t){return Object(y.c)(t.format)&&""!==t.getProtocol(e._getBaseProtocol())})),l.progressive=e._parseProgressiveSources(u,s,r,n,a,i.id)),l},e._parseAdaptiveSource=function(t,r,n,a,i,s){var o=new f.a;if(t){var l="",d=y.b.get(t.format),h=t.getProtocol(e._getBaseProtocol()),v=t.deliveryProfileId,m=t.format,g="";if(d&&(g=d.pathExt,o.mimetype=d.mimeType),t.hasFlavorIds()?(!g&&r.flavorAssets&&r.flavorAssets.length>0&&(g=r.flavorAssets[0].fileExt),l=c.build({entryId:s,flavorIds:t.flavorIds,format:m,ks:n,partnerId:a,uiConfId:i,extension:g,protocol:h})):l=e.addKsToUrl(t.url,n),!l){var _="failed to create play url from source, discarding source: ("+s+"_"+v+"), "+m;return e._logger.warn(_),null}if(o.url=e._applyRegexAction(r,l),o.id=s+"_"+v+","+m,t.hasDrmData()){var E=[];t.drm.forEach((function(e){E.push(new p.a(e.licenseURL,u.a.Scheme[e.scheme],e.certificate))})),o.drmData=E}}return o},e._parseProgressiveSources=function(t,r,n,a,i,s){var o=[],u=[];if(t){var l=t.getProtocol(e._getBaseProtocol()),d=t.format,p=t.deliveryProfileId,h=p+","+d;r.flavorAssets.map((function(t){var y=new f.a;y.id=t.id+h,y.mimetype="mp3"===t.fileExt?"audio/mp3":"video/mp4",y.height=t.height,y.width=t.width,y.bandwidth=1024*t.bitrate,y.label=t.label||t.language;var v=c.build({entryId:s,flavorIds:t.id,format:d,ks:n,partnerId:a,uiConfId:i,extension:t.fileExt,protocol:l});if(""===v)return e._logger.warn("failed to create play url from source, discarding source: ("+s+"_"+p+"), "+d+"."),null;y.url=e._applyRegexAction(r,v),t.height&&t.width?o.push(y):u.push(y)}))}return u.length&&!o.length?u:o},e._parseMetadata=function(e){var t={};return e&&e.metas&&e.metas.length>0&&e.metas.forEach((function(e){if(e.xml){var r,n=new DOMParser;e.xml=e.xml.replace(/\r?\n|\r/g,""),e.xml=e.xml.replace(/>\s*/g,">"),e.xml=e.xml.replace(/>\s*/g,">"),r=n.parseFromString(e.xml,"text/xml");var a=l.xmlToJson(r);Object.keys(a.metadata).forEach((function(e){t[e]=a.metadata[e]["#text"]}))}})),t},e._getBaseProtocol=function(){var e=a.a.get(),t=/^https?:/.exec(e.cdnUrl),r=t?t[0]:document.location.protocol;return"string"==typeof r?r.slice(0,-1):"https"},e.hasBlockAction=function(e){return e.playBackContextResult.hasBlockAction()},e.getBlockAction=function(e){return e.playBackContextResult.getBlockAction()},e.getErrorMessages=function(e){return e.playBackContextResult.getErrorMessages()},e._applyRegexAction=function(e,t){var r=e.getRequestHostRegexAction();if(r){var n=new RegExp(r.pattern,"i");if(t.match(n))return t.replace(n,r.replacement+"/")}return t},e}();b=T,R="_logger",O=Object(n.b)("OVPProviderParser"),R in b?Object.defineProperty(b,R,{value:O,enumerable:!0,configurable:!0,writable:!0}):b[R]=O;var C=T.addKsToUrl,P=T,w=r(2),A=r(11),S=r(29),k=r(20);function D(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function M(e,t,r){return t&&D(e.prototype,t),r&&D(e,r),e}var j=function(){function e(e){!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"_response",{}),this.requests=this.buildRequests(e),this._entryId=e.entryId,this._referenceId=e.referenceId}M(e,null,[{key:"id",get:function(){return"media"}}]);var t=e.prototype;return t.buildRequests=function(e){var t=a.a.get(),r=[];r.push(A.a.list(t.serviceUrl,e.ks,e.entryId,e.redirectFromEntryId,e.referenceId));var n="{1:result:ks}"===e.ks?"{2:result:objects:0:id}":"{1:result:objects:0:id}";return r.push(A.a.getPlaybackContext(t.serviceUrl,e.ks,n)),r.push(S.a.list(t.serviceUrl,e.ks,n)),r},t.isValid=function(){return!(!this._entryId&&!this._referenceId)},M(e,[{key:"requests",set:function(e){this._requests=e},get:function(){return this._requests}},{key:"response",set:function(e){var t=new k.a(e[0].data);this._response.entry=t.entries[0],this._response.playBackContextResult=new i.a(e[1].data),this._response.metadataListResult=new s.a(e[2].data)},get:function(){return this._response}}]),e}(),L=r(12),N=r(16),x=r(8);var U=function(e){var t,r;function n(t,r,n,a){var i;return void 0===n&&(n=""),(i=e.call(this,a)||this)._multiRequest=x.a.getMultiRequest(t,n,r),i}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n}(N.a),q=r(24);var V=function(e){var t,r;function n(){return e.apply(this,arguments)||this}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n.execute=function(e,t,r){var n=new Map;n.set("Content-Type","application/json");var a=new w.a(n);return a.service="playlist",a.action="execute",a.method="POST",a.url=a.getUrl(e),a.tag="playlist-execute",a.params={ks:t,id:r,responseProfile:new q.a},a},n.get=function(e,t,r){var n=new Map;n.set("Content-Type","application/json");var a=new w.a(n);return a.service="playlist",a.action="get",a.method="POST",a.url=a.getUrl(e),a.tag="playlist-get",a.params={ks:t,id:r,responseProfile:{fields:"id,name,description,thumbnailUrl",type:1}},a},n}(x.a),F=function(e){this.id=e.id,this.name=e.name,this.description=e.description,this.poster=e.thumbnailUrl};var H=function(e){var t,r;function n(t){var r;return(r=e.call(this,t)||this).hasError||(r.entries=[],t.map((function(e){return r.entries.push(new o.a(e))}))),r}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n}(r(7).a);function B(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function W(e,t,r){return t&&B(e.prototype,t),r&&B(e,r),e}var G=function(){function e(e){!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"_response",{}),this.requests=this.buildRequests(e),this._playlistId=e.playlistId}W(e,null,[{key:"id",get:function(){return"playlist"}}]);var t=e.prototype;return t.buildRequests=function(e){var t=a.a.get(),r=[];return r.push(V.get(t.serviceUrl,e.ks,e.playlistId)),r.push(V.execute(t.serviceUrl,e.ks,e.playlistId)),r},t.isValid=function(){return!!this._playlistId},W(e,[{key:"requests",set:function(e){this._requests=e},get:function(){return this._requests}},{key:"response",set:function(e){this._response.playlistData=new F(e[0].data),this._response.playlistItems=new H(e[1].data)},get:function(){return this._response}}]),e}(),K=r(25);function Y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function J(e,t,r){return t&&Y(e.prototype,t),r&&Y(e,r),e}var X=function(){function e(e){!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"_response",{playlistItems:{entries:[]}}),this.requests=this.buildRequests(e),this._entries=e.entries}J(e,null,[{key:"id",get:function(){return"entry_list"}}]);var t=e.prototype;return t.buildRequests=function(e){var t=a.a.get(),r=[];return e.entries.forEach((function(n){r.push(A.a.list(t.serviceUrl,e.ks,n.entryId||n,e.redirectFromEntryId,n.referenceId))})),r},t.isValid=function(){return!(!this._entries||!this._entries.length)},J(e,[{key:"requests",set:function(e){this._requests=e},get:function(){return this._requests}},{key:"response",set:function(e){var t,r=this;e.forEach((function(e){t=new k.a(e.data),r._response.playlistItems.entries.push(t.entries[0])}))},get:function(){return this._response}}]),e}(),Q=r(0);var $=function(e){var t,r;function i(t,r){var i;return function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i=e.call(this,t,r)||this),"_filterOptionsConfig",{redirectFromEntryId:!0}),i._logger=Object(n.b)("OVPProvider"),a.a.set(t.env),i._setFilterOptionsConfig(t.filterOptions),i._networkRetryConfig=Object.assign(i._networkRetryConfig,t.networkRetryParameters),i}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var s=i.prototype;return s.getMediaConfig=function(e){var t=this;return e.ks&&(this.ks=e.ks,this._isAnonymous=!1),this.widgetId!==this.defaultWidgetId&&(this._isAnonymous=!1),this._dataLoader=new U(this.playerVersion,this.partnerId,this.ks,this._networkRetryConfig),new Promise((function(r,n){var a=e.entryId,i=e.referenceId;if(a||i){var s=t.ks;s||(s="{1:result:ks}",t._dataLoader.add(L.a,{widgetId:t.widgetId}));var o=t._getEntryRedirectFilter(e);return t._dataLoader.add(j,{entryId:a,ks:s,redirectFromEntryId:o,referenceId:i}),t._dataLoader.fetchData().then((function(e){try{r(t._parseDataFromResponse(e))}catch(e){n(e)}}),(function(e){n(e)}))}n(new Q.a(Q.a.Severity.CRITICAL,Q.a.Category.PROVIDER,Q.a.Code.MISSING_MANDATORY_PARAMS,{message:"missing entry id"}))}))},s._getEntryRedirectFilter=function(e){return"boolean"==typeof e.redirectFromEntryId?e.redirectFromEntryId:"boolean"!=typeof this._filterOptionsConfig.redirectFromEntryId||this._filterOptionsConfig.redirectFromEntryId},s._setFilterOptionsConfig=function(e){e&&"boolean"==typeof e.redirectFromEntryId&&(this._filterOptionsConfig.redirectFromEntryId=e.redirectFromEntryId)},s._parseDataFromResponse=function(e){this._logger.debug("Data parsing started");var t={session:{isAnonymous:this._isAnonymous,partnerId:this.partnerId},sources:this._getDefaultSourcesObject(),plugins:{}};if(this.uiConfId&&(t.session.uiConfId=this.uiConfId),e){if(e.has(L.a.id)){var r=e.get(L.a.id);r&&r.response&&(t.session.ks=r.response,this.widgetId!==this.defaultWidgetId&&(this.ks=t.session.ks))}else t.session.ks=this.ks;if(e.has(j.id)){var n=e.get(j.id);if(n&&n.response){var a=n.response;if(P.hasBlockAction(a))throw new Q.a(Q.a.Severity.CRITICAL,Q.a.Category.SERVICE,Q.a.Code.BLOCK_ACTION,{action:P.getBlockAction(a),messages:P.getErrorMessages(a)});var i=P.getMediaEntry(this.isAnonymous?"":this.ks,this.partnerId,this.uiConfId,a);Object.assign(t.sources,this._getSourcesObject(i)),this._verifyMediaStatus(i),this._verifyHasSources(t.sources);var s=P.getBumper(a,this.isAnonymous?"":this.ks,this.partnerId);s&&Object.assign(t.plugins,{bumper:s})}}}return this._logger.debug("Data parsing finished",t),t},s._verifyMediaStatus=function(e){if([o.a.EntryStatus.IMPORT,o.a.EntryStatus.PRECONVERT].includes(e.status))throw new Q.a(Q.a.Severity.CRITICAL,Q.a.Category.SERVICE,Q.a.Code.MEDIA_STATUS_NOT_READY,{messages:"Status of entry id "+e.id+" is "+e.status+" and is still being imported or converted",data:{status:status}})},s.getPlaylistConfig=function(e){var t=this;return e.ks&&(this.ks=e.ks,this._isAnonymous=!1),this.widgetId!==this.defaultWidgetId&&(this._isAnonymous=!1),this._dataLoader=new U(this.playerVersion,this.partnerId,this.ks,this._networkRetryConfig),new Promise((function(r,n){var a=e.playlistId;if(a){var i=t.ks;i||(i="{1:result:ks}",t._dataLoader.add(L.a,{widgetId:t.widgetId})),t._dataLoader.add(G,{playlistId:a,ks:i}),t._dataLoader.fetchData().then((function(e){r(t._parsePlaylistDataFromResponse(e))}),(function(e){n(e)}))}else n({success:!1,data:"Missing mandatory parameter"})}))},s._parsePlaylistDataFromResponse=function(e){var t=this;this._logger.debug("Data parsing started");var r=this._getPlaylistObject();if(e&&e.has(G.id)){var n=e.get(G.id);if(n&&n.response){var a=P.getPlaylist(n.response);r.id=a.id,r.poster=a.poster,r.metadata.name=a.name,r.metadata.description=a.description,a.items.forEach((function(e){return r.items.push({sources:t._getSourcesObject(e)})}))}}return this._logger.debug("Data parsing finished",r),r},s.getEntryListConfig=function(e){var t=this;return e.ks&&(this.ks=e.ks,this._isAnonymous=!1),this.widgetId!==this.defaultWidgetId&&(this._isAnonymous=!1),this._dataLoader=new U(this.playerVersion,this.partnerId,this.ks,this._networkRetryConfig),new Promise((function(r,n){var a=e.entries;if(a&&a.length){var i=t.ks;i||(i="{1:result:ks}",t._dataLoader.add(L.a,{widgetId:t.widgetId}));var s=t._getEntryRedirectFilter(e);t._dataLoader.add(X,{entries:a,ks:i,redirectFromEntryId:s}),t._dataLoader.fetchData().then((function(e){r(t._parseEntryListDataFromResponse(e))}),(function(e){n(e)}))}else n({success:!1,data:"Missing mandatory parameter"})}))},s._parseEntryListDataFromResponse=function(e){var t=this;this._logger.debug("Data parsing started");var r=this._getPlaylistObject();if(e&&e.has(X.id)){var n=e.get(X.id);if(n&&n.response)P.getEntryList(n.response).items.forEach((function(e){return r.items.push({sources:t._getSourcesObject(e)})}))}return this._logger.debug("Data parsing finished",r),r},s._getPlaylistObject=function(){return{id:"",metadata:{name:"",description:""},poster:"",items:[]}},s._getDefaultSourcesObject=function(){return{hls:[],dash:[],progressive:[],id:"",duration:0,type:d.a.Type.UNKNOWN,poster:"",dvr:!1,vr:null,metadata:{name:"",description:"",tags:""}}},s._getSourcesObject=function(e){var t=this._getDefaultSourcesObject(),r=e.sources.toJSON();return t.hls=r.hls,t.dash=r.dash,t.progressive=r.progressive,t.id=e.id,t.duration=e.duration,t.type=e.type,t.dvr=!!e.dvrStatus,t.poster=e.poster,e.sources.captions&&(t.captions=e.sources.captions),e.metadata&&"string"==typeof e.metadata.tags&&e.metadata.tags.indexOf("360")>-1&&(t.vr={}),Object.assign(t.metadata,e.metadata),t},i}(K.a)},,,function(e,t,r){"use strict";r.r(t),r.d(t,"Provider",(function(){return O})),r.d(t,"NAME",(function(){return T})),r.d(t,"VERSION",(function(){return C}));var n=r(3),a=r(2),i=r(11),s=r(29),o=r(21),u={serviceUrl:"https://cdnapisec.kaltura.com/api_v3",cdnUrl:"https://cdnapisec.kaltura.com",serviceParams:{apiVersion:"3.3.0",format:1},useApiCaptions:!0},c=function(){function e(){}return e.set=function(e){e&&Object.assign(u,e)},e.get=function(){return Object(o.a)(u)},e}(),l=r(22),d=r(23),p=r(20);var f=function(e){var t,r;function n(){return e.apply(this,arguments)||this}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n.getContextData=function(e,t,r){var n=new Map;n.set("Content-Type","application/json");var i=new a.a(n);i.service="baseEntry",i.action="getContextData",i.method="POST",i.url=i.getUrl(e),i.tag="baseEntry-getContextData";return i.params={entryId:r,ks:t,contextDataParams:{objectType:"KalturaEntryContextDataParams",flavorTags:"all"}},i},n}(i.a);function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),e}var v=function(){function e(e){var t,r,n;n={},(r="_response")in(t=this)?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,this.requests=this.buildRequests(e),this._entryId=e.entryId,this._referenceId=e.referenceId}y(e,null,[{key:"id",get:function(){return"media"}}]);var t=e.prototype;return t.buildRequests=function(e){var t=c.get(),r=[];r.push(i.a.list(t.serviceUrl,e.ks,e.entryId,e.redirectFromEntryId,e.referenceId));var n="{1:result:ks}"===e.ks?"{2:result:objects:0:id}":"{1:result:objects:0:id}";return r.push(f.getContextData(t.serviceUrl,e.ks,n)),r.push(s.a.list(t.serviceUrl,e.ks,n)),r},t.isValid=function(){return!(!this._entryId&&!this._referenceId)},y(e,[{key:"requests",set:function(e){this._requests=e},get:function(){return this._requests}},{key:"response",set:function(e){console.log(e);var t=new p.a(e[0].data);e[1].data.sources=[{format:"applehttp",deliveryProfileId:"",url:"https://open.http.mp.streamamg.com/p/3000178/sp/300017800/playManifest/entryId/"+t.entries[0].id+"/format/applehttp/protocol/https/a.m3u8",protocols:"https",flavorIds:e[1].data.flavorAssets.map((function(e){return e.id})).join(",")}],this._response.entry=t.entries[0],this._response.playBackContextResult=new l.a(e[1].data),this._response.metadataListResult=new d.a(e[2].data)},get:function(){return this._response}}]),e}(),m=r(12),g=r(16),_=r(0),E=r(13);var I=function(e){var t,r;function n(){return e.apply(this,arguments)||this}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var a=n.prototype;return a.add=function(e){return this.requests.push(e),this.params[this.requests.length+":service"]=e.service,this.params[this.requests.length+":action"]=e.action,this.addParams(this.requests.length+":",e.params),this},a.addParams=function(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];"object"==typeof t[a]?this.addParams(e+a+":",t[a]):this.params[e+a]=t[a]}},a.execute=function(){var e=this;return new Promise((function(t,r){e.doHttpRequest().then((function(n){var a=new E.a(n);a.success?t({headers:e.responseHeaders,response:a}):r(new _.a(_.a.Severity.CRITICAL,_.a.Category.NETWORK,_.a.Code.MULTIREQUEST_API_ERROR,{url:e.url,headers:e.responseHeaders,results:a.results}))}),(function(e){r(e)}))}))},a._createXHR=function(){var e,t=this,r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState&&200===r.status)try{console.error(r);var e=JSON.parse(r.responseText);return t.responseHeaders=t._getResponseHeaders(r),t._requestPromise.resolve(e)}catch(e){t._requestPromise.reject(t._createError(r,_.a.Code.BAD_SERVER_RESPONSE,{text:r.responseText}))}};var n=this.url.split("?")[0]+function(e){if(0==Object.keys(e).length)return"";return"?"+function(e){for(var t=[],r=function(){var r=a[n];if(Array.isArray(e[r]))return e[r+="[]"].forEach((function(e){t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))})),"continue";t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]))},n=0,a=Object.keys(e);n<a.length;n++)r();return t.join("&")}(e)}(Object.assign({service:this.service,action:null!=(e=this.action)?e:""},this.params));r.open(this.method,n,this.retryConfig.async),this.retryConfig.async&&this.retryConfig.timeout&&(r.timeout=this.retryConfig.timeout);var a=performance.now();r.ontimeout=function(){t._handleError(r,_.a.Code.TIMEOUT,{timeout:(performance.now()-a)/1e3,statusText:r.statusText})},r.onerror=r.onabort=function(){t._handleError(r,_.a.Code.HTTP_ERROR,{text:r.responseText,statusText:r.statusText})},this.headers.forEach((function(e,t){r.setRequestHeader(t,e)})),r.send(this.params)},n}(E.b);var b=function(){function e(){}return e.getMultiRequest=function(e,t,r){var n=c.get(),a=n.serviceParams;Object.assign(a,{ks:t,clientTag:"html5:v"+e}),r&&Object.assign(a,{partnerId:r});var i=new Map,s=new I(i);return s.method="GET",s.service="multirequest",s.url=s.getUrl(n.serviceUrl.match("/index.php$")?n.serviceUrl:n.serviceUrl+"/index.php"),s.params=a,s},e}();var R=function(e){var t,r;function n(t,r,n,a){var i;return void 0===n&&(n=""),(i=e.call(this,a)||this)._multiRequest=b.getMultiRequest(t,n,r),i}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n}(g.a);var O=function(e){var t,r;function a(t,r){var a;return(a=e.call(this,t,r)||this)._logger=Object(n.b)("StreamAMGProvider"),c.set(t.env),a._setFilterOptionsConfig(t.filterOptions),a._networkRetryConfig=Object.assign(a._networkRetryConfig,t.networkRetryParameters),a}return r=e,(t=a).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,a.prototype.getMediaConfig=function(e){var t=this;return e.ks&&(this.ks=e.ks,this._isAnonymous=!1),this.widgetId!==this.defaultWidgetId&&(this._isAnonymous=!1),this._dataLoader=new R(this.playerVersion,this.partnerId,this.ks,this._networkRetryConfig),new Promise((function(r,n){var a=e.entryId,i=e.referenceId;if(a||i){var s=t.ks;s||(s="{1:result:ks}",t._dataLoader.add(m.a,{widgetId:t.widgetId}));var o=t._getEntryRedirectFilter(e);return t._dataLoader.add(v,{entryId:a,ks:s,redirectFromEntryId:o,referenceId:i}),t._dataLoader.fetchData().then((function(e){try{r(t._parseDataFromResponse(e))}catch(e){n(e)}}),(function(e){n(e)}))}n(new _.a(_.a.Severity.CRITICAL,_.a.Category.PROVIDER,_.a.Code.MISSING_MANDATORY_PARAMS,{message:"missing entry id"}))}))},a}(r(30).a),T="playkit-js-providers-streamamg",C="2.28.1"}])}));
//# sourceMappingURL=playkit-streamamg-provider.js.map